<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="scoreboard.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
    <meta charset="utf-8">
    <script>
        window.addEventListener("load", function (evt) {

            var updateMapCSS = function (data) {
                var homeMaps = [1, 2, 3].map(x => `home-map-${x}`)
                var awayMaps = [1, 2, 3].map(x => `away-map-${x}`)
                if (data.HomeMaps > 0) {
                    for (var i = 0; i < data.HomeMaps; i++) {
                        var elem = document.getElementById(homeMaps[i])
                        elem.setAttribute("class", "home-oval-filled")
                    }
                }
                else {
                    homeMaps.forEach(id => document.getElementById(id).className = "oval-empty")
                }
                if (data.AwayMaps > 0) {
                    for (var j = 0; j < data.AwayMaps; j++) {
                        var elem = document.getElementById(awayMaps[j])
                        elem.setAttribute("class", "away-oval-filled")
                    }
                }
                else {
                    awayMaps.forEach(id => document.getElementById(id).className = "away-oval-empty")
                }
            }
            var updateScoreData = function (json) {
                var data = JSON.parse(json)
                console.log(data)
                document.getElementById("home-name").innerText = data.Home.Name
                document.getElementById("away-name").innerText = data.Away.Name
                document.getElementById("home-stats").innerText = data.Home.Stats.MatchesWon + "-" + data.Home.Stats.MatchesLost
                document.getElementById("away-stats").innerText = data.Away.Stats.MatchesWon + "-" + data.Away.Stats.MatchesLost
                document.getElementById("home-total").innerText = data.HomeGames
                document.getElementById("away-total").innerText = data.AwayGames
                document.getElementById("home-img").src = data.Home.Img
                document.getElementById("away-img").src = data.Away.Img
                updateMapCSS(data)

                if (data.HomeGames == 3) {
                    document.getElementById("home-winner").className += " has-background-danger"
                }
                if (data.AwayGames == 3) {
                    document.getElementById("away-winner").className += " has-background-danger"
                }
            }

            var ws;
            function connect() {
                ws = new WebSocket('ws://localhost:8080/ws');

                ws.onmessage = function (evt) {
                    updateScoreData(evt.data)
                }

                ws.onclose = function (e) {
                    console.log('Socket is closed. Reconnect will be attempted in 1 second.', e.reason);
                    setTimeout(function () {
                        connect();
                    }, 1000);
                };

                ws.onerror = function (err) {
                    console.error('Socket encountered error: ', err.message, 'Closing socket');
                    ws.close();
                };
            }

            connect();

            document.getElementById("dark-mode").addEventListener("click", function () {
                document.getElementById("home-winner").classList.toggle("has-background-dark");
                document.getElementById("away-winner").classList.toggle("has-background-dark");
                document.getElementById("chroma-box").classList.remove("hidden");
                document.getElementById("home-total").classList.toggle("has-text-light");
                document.getElementById("away-total").classList.toggle("has-text-light");
                document.getElementById("home-stats").classList.toggle("has-text-light");
                document.getElementById("away-stats").classList.toggle("has-text-light");
            });

            document.getElementById("transparent-mode").addEventListener("click", function () {
                document.getElementById("home-winner").classList.toggle("is-transparent");
                document.getElementById("away-winner").classList.toggle("is-transparent");
                document.getElementById("chroma-box").className = "chroma-box";
            });
            document.getElementById("white-mode").addEventListener("click", function () {
                document.getElementById("home-winner").className = "left home-box";
                document.getElementById("away-winner").className = "right away-box";
                document.getElementById("chroma-box").className = "hidden";
            });
        });
    </script>
</head>

<body>
    <div id="home-winner" class="left home-box">
        <article class="media">
            <div class="media-left">
                <figure class="image is-64x64">
                    <img id="home-img" src="https://bulma.io/images/placeholders/128x128.png" alt="Image">
                </figure>
            </div>
            <div class="media-content">
                <div class="content">
                    <p>
                        <strong id="home-name" class="has-text-link is-size-5">Home Team</strong>
                        <br>
                        <span id="home-stats" class="is-size-5">(0-0)</span>
                    </p>
                </div>
            </div>
            <div class="media-right">
                <div class="content">
                    <div id="home-map-1" class="oval-empty"></div>
                    <div id="home-map-2" class="oval-empty"></div>
                    <div id="home-map-3" class="oval-empty"></div>
                    <span>&nbsp; &nbsp;</span>
                    <h1 id="home-total" class="is-inline-block score-text">
                        0
                    </h1>
                </div>
            </div>
        </article>
    </div>
    <div id="chroma-box" class="chroma-box"></div>
    <div id="away-winner" class="right away-box">
        <article class="media">
            <div class="media-left">
                <div class="content">
                    <h1 id="away-total" class="is-inline-block score-text">
                        0
                    </h1>
                    <span>&nbsp; &nbsp;</span>
                    <div id="away-map-3" class="away-oval-empty"></div>
                    <div id="away-map-2" class="away-oval-empty"></div>
                    <div id="away-map-1" class="away-oval-empty"></div>
                </div>
            </div>
            <div class="media-content">
                <div class="content">
                    <p>
                        <strong id="away-name" class="has-text-warning is-size-5">Away Team</strong>
                        <br>
                        <span id="away-stats" class="is-size-5">(0-0)</span>
                    </p>
                </div>
            </div>
            <div class="media-right">
                <figure class="image is-64x64">
                    <img id="away-img" src="https://bulma.io/images/placeholders/128x128.png" alt="Image">
                </figure>
            </div>
        </article>
    </div>
    <button id="dark-mode" class="button bottom">Dark Background</button>
    <button id="transparent-mode" class="button bottom">Transparent Background</button>
    <button id="white-mode" class="button bottom">White Background</button>
</body>

</html>